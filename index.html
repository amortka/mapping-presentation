<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>maps and data visualizations in d3.js</title>

    <link rel="stylesheet" href="css/reveal.css">
    <link rel="stylesheet" href="css/theme/monomap.css">
    <link rel="stylesheet" href="lib/css/zenburn.css">
    <link rel="stylesheet" href="assets/leaflet.css">

    <!-- Printing and PDF exports -->
    <script>
        var link = document.createElement('link');
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = window.location.search.match(/print-pdf/gi) ? 'css/print/pdf.css' : 'css/print/paper.css';
        document.getElementsByTagName('head')[0].appendChild(link);
    </script>
</head>

<body>
<div class="reveal">
    <div class="slides">
        <section id="title">
            <h1 class="text-left">Maps and animations with d3.js</h1>
            <h3 class="text-left text-light">basic ideas to draw map and animate things!</h3>
        </section>

        <section id="agenda">
            <h1>Agenda</h1>
            <ul>
                <li>geo projections</li>
                <li>geojson vs toposjon</li>
                <li>d3 data vs datum</li>
                <li>simple map</li>
                <li>d3 load csv</li>
                <li>visualize data on map</li>
                <li>d3 as overlay for leaflet</li>
                <li>animations in d3</li>
            </ul>
        </section>

        <section id="geo-projections">
            <section id="geo-projections-intro" data-scripted>
                <h1>Geoprojection</h1>
                <h2>why so important?</h2>
            </section>
            <section id="geo-projections-mercator">
                <h1>mercator projection</h1>
                <h3>srs code EPSG:3857</h3>
                <ol>
                    <li>
                        <p>Scale is the same in all directions.</p>
                        <small>(A mile along a road should look the same length no matter which way the road is
                            facing.)
                        </small>
                    </li>
                    <li>
                        <p>Angles are depicted accurately.</p>
                        <small>(If the map directs me to make what looks like a 90° left turn, or to bear right 30°,
                            then that’s what I actually do.)
                        </small>
                    </li>
                    <li>
                        <p>A small real-life circle like the should be shown as a circle on the map, not squashed into
                            an ellipse.</p>
                    </li>
                    <li>
                        <p>By convention, north should always point straight up.</p>
                    </li>
                </ol>
                <img src="assets/_old/Tissot_mercator.png"/>
            </section>
            <section id="geo-projections-mercator-distortions">
                <h1>Mercator projection distortion</h1>
                <img src="assets/images/mercator-greenland-vs-africa.png"/>
                <img class="fragment" src="assets/images/winkel_triple_projection.jpg"/>
                <img class="fragment" src="assets/images/1280px-tissot_indicatrix_world_map_winkel_tripel_proj.png"/>
                <a href="https://en.wikipedia.org/wiki/Winkel_tripel_projection" class="source">en.wikipedia.org/wiki/Winkel_tripel_projection</a>
            </section>
            <section id="geo-projections-albers-usa" data-scripted>
                <h1>Choose right projection</h1>
                <pre class="expand"><code>...</code></pre>
            </section>
            <section id="geo-projections-mercator-usa" data-scripted>
                <h1>so close...</h1>
                <pre class="expand"><code>...</code></pre>
            </section>
            <section id="geo-convert-shp-geojson">
                <h1>Convert data</h1>
                <h3>from shp to geojson</h3>
                <a href="http://www.gdal.org/ogr2ogr.html"><img src="assets/images/gdal-ogr2ogr.png"/></a>
                <a href="http://www.gdal.org/ogr2ogr.html" class="source">www.gdal.org/ogr2ogr.html</a>
            </section>
            <section id="geo-convert-shp-geojson-onlinee">
                <h1>ogr2ogr online</h1>
                <a href="https://ogre.adc4gis.com/"><img src="assets/images/ogr2ogr-online.png"/></a>
                <a href="https://ogre.adc4gis.com/" class="source">ogre.adc4gis.com</a>
            </section>
            <section id="geo-convert-projection">
                <h2>geojson default projection - WGS84</h2>
                <p>Convert ETRS 1989 Poland CS2000 Zone 6 (EPSG:2177) to WGS84 (EPSG:4326) datum</p>
                <img src="assets/images/geoporta-wroclaw-osiedla.png"/>
                <a href="http://www.spatialreference.org/ref/epsg/etrs89-poland-cs2000-zone-6" class="source">spatialreference.org/ref/epsg/etrs89-poland-cs2000-zone-6</a>
            </section>
        </section>

        <section id="first-map">
            <section id="first-map-world" data-scripted>
                <h1>First map - world</h1>
                <pre class="expand"><code>...</code></pre>
            </section>
            <section id="first-map-world-zoom" data-scripted>
                <h1>Zoom and drag behavior</h1>
                <pre class="expand"><code>...</code></pre>
            </section>
            <section id="first-map-world-queue" data-scripted>
                <h1>Load data from json&csv with queue</h1>
                <pre class="expand"><code>...</code></pre>
            </section>
        </section>

        <section id="visualize-data">
            <section id="visualize-data-points">
                <h1>Visualize simple points, lines</h1>
            </section>
            <section id="visualize-data-population"></section>
            <section id="visualize-data-areas"></section>
            <section id="visualize-data-choropleth"></section>
            <section id="visualize-data-voronoi"></section>
            <section id="visualize-data-animate-path"></section>
        </section>

        <section id="d3-leaflet">
            <section id="d3-leaflet-start"></section>
            <section id="d3-leaflet-clip"></section>
            <section id="d3-leaflet-animate"></section>
        </section>

        <section id="d3-animations">
            <section id="d3-animations-intro"></section>
            <section id="d3-animations-tween"></section>
            <section id="d3-animations-loop"></section>
            <section id="d3-animations-particles"></section>
        </section>

        <section id="d3-demos">
            <section id="d3-demos-infinity"></section>
            <section id="d3-demos-travel-world"></section>
        </section>

    </div>
</div>

<script src="lib/js/head.min.js"></script>
<script src="js/reveal.js"></script>
<script src="assets/js/lib/lodash.min.js"></script>
<script src="assets/js/lib/topojson.v1.min.js"></script>
<script src="assets/js/lib/async.min.js"></script>
<script src="assets/js/lib/leaflet-src.js"></script>

<script src="assets/js/lib/d3.min.js"></script>
<script src="assets/js/lib/d3-selection.v1.min.js"></script>
<script src="assets/js/lib/d3-request.v1.min.js"></script>
<script src="assets/js/lib/d3-array.v1.min.js"></script>
<script src="assets/js/lib/d3-transition.v1.min.js"></script>
<script src="assets/js/lib/d3-geo.v1.min.js"></script>
<script src="assets/js/lib/d3-geo-projection.v1.min.js"></script>

<script>
    Reveal.initialize({
        history: true,
        progress: false,
        parallaxBackgroundImage: 'assets/images/background-big.png',
        parallaxBackgroundSize: '3000px 1500px',
        dependencies: [
            {
                src: 'plugin/markdown/marked.js'
            }, {
                src: 'plugin/markdown/markdown.js'
            }, {
                src: 'plugin/notes/notes.js',
                async: true
            }, {
                src: 'plugin/highlight/highlight.js',
                async: true,
                callback: function() {
                    hljs.initHighlightingOnLoad();
                }
            }
        ]
    });

    Reveal.addEventListener('fragmentshown', function(ev) {
        console.log('fragmentshown', ev);
        if (ev.fragment.dataset) {
//            console.log(JSON.stringify(ev.fragment.dataset, false, 2));
        }
    });

    Reveal.addEventListener('ready', function(event) {
//        console.log('-- revel is ready:', event.previousSlide, event.currentSlide, event.indexh, event.indexv);
    });
    Reveal.addEventListener('slidechanged', function(event) {
//        console.log('-- slidechanged:', event.previousSlide, event.currentSlide, event.indexh, event.indexv);

        var nextId = event.currentSlide.id;
        var prevId = event.previousSlide ? event.previousSlide.id : null;

        var data = event.currentSlide.dataset;

        if (!_.isUndefined(data.scripted)) {
            appendScript(nextId);
        }

        if (prevId && !_.isUndefined(event.previousSlide.dataset.scripted)) {
            unloadScript(prevId);
        }
    });

    function appendScript(fileName) {
        var scriptElements = document.getElementsByTagName('script');
        var moduleName = (['module', fileName].join('-')).replace(/(\-\w)/g, function(m) {
            return m[1].toUpperCase();
        });

        if (!_.find(scriptElements, function(script) {
                    return new RegExp(fileName+'\.js$', 'i').test(script.src);
                })) {

            var scriptEl = document.createElement('script');
            scriptEl.setAttribute("type", "text/javascript");
            scriptEl.setAttribute('src', 'assets/js/' + fileName + '.js');
            scriptEl.onload = function() {
                try {
                    window[moduleName].init();
                } catch (e) {
                    console.log('exception', e);
                }
            };
            document.body.appendChild(scriptEl);
        } else {
            console.log('trying to reset module:', moduleName);
            try {
                window[moduleName].reset();
            } catch (e) {
                console.log('exception', e);
            }
        }
    }

    function unloadScript(fileName) {
        var moduleName = (['module', fileName].join('-')).replace(/(\-\w)/g, function(m) {
            return m[1].toUpperCase();
        });
        try {
            window[moduleName].unload();
        } catch (e) {
            console.log('exception', e);
        }
    }
</script>
</body>

</html>
